<div class="oer-main">

  <h2> <%= @app.name %> </h2>

  <% if @favorite %>
    <span class="icon-favorite-blue_32_34 show text-replacement pull-right" rel="tooltip" title="Este é um Aplicativo Favorito." data-placement="left">Favorito</span>
  <% end %>

  <div class="oer-data">
    <%= image_tag @app.thumbnail.url(:large) %>

    <ol class="oer-stars<%= " oer-stars-user-rated" if current_user %>">
      <% app_reputation = @app.reputation_for(:rating) %>
      <% user_rating = 0 %>
      <% index = 0 %>
      <%# Renderiza as estrelas azuis da nota do usuário. %>
      <% if current_user %>
        <% user_rating = @user_rating.to_i %>
        <% index = user_rating %>
        <% user_rating.times do |n| %>
          <%= render "star", index: n, type: "blue" %>
        <% end %>
      <% end %>
      <%# Renderiza as estrelas cinza escuro da média de classificação. %>
      <% if app_reputation > user_rating %>
        <% (app_reputation - user_rating).to_i.times do |n| %>
          <%= render "star", index: index, type: "gray" %>
          <% index += 1 %>
        <% end %>
      <% end %>
      <%# Renderiza as estrelas cinza claro restantes. %>
      <% (5 - index).times do |n| %>
        <%= render "star", index: index, type: "lightgray" %>
        <% index += 1 %>
      <% end %>
    </ol>

    <h6><%= app_reputation %><span>/5</span></h6>
    <ul class="data-app">
      <% if @user %>
        <li class="app-rating">
          <% if @evaluated %>
            Você classificou em <%= t "star", count: user_rating %>.
          <% else %>
            Classifique este Recurso.
          <% end %>
        </li>
      <% end %>
      <li class="icon-star-empty-gray_16_18-before">
        <%= t 'evaluation', count: @evaluations %>.
      </li>
      <li class="icon-favorite-gray_16_18-before">
        <%= t 'favorite', count: @app.users.count %>.
      </li>
      <li class="icon-seen-gray_16_18-before">
        <%= t 'view', count: @app.views %>.
      </li>
      <% if @app.comments.specialized.length > 0 %>
        <li class="icon-specialist-gray_16_18-before">
          <%= t 'review', count: @app.comments.specialized.length %>.
        </li>
      <% end %>
      <li class="icon-comment-gray_16_18-before">
        <%= t 'comment',
              count: (@app.comments.common.length + @app.comments.answer.length) %>.
      </li>
    </ul>

    <div class="oer-cc">
      <%= link_to "Licença por Atribução (by)", "http://creativecommons.org.br/as-licencas/", class: "cc-by-88_31 text-replacement", target: "_blank", rel: "popover", "data-original-title" => "Licença por Atribuição (by)", "data-content" => "Esta licença permite que outros distribuam, remixem, adaptem ou criem obras derivadas, mesmo que para uso com fins comerciais, contanto que seja dado crédito pela criação original. Esta é a licença menos restritiva de todas as oferecidas, em termos de quais usos outras pessoas podem fazer de sua obra.", "data-placement" => "bottom" %>
    </div>
  </div>


  <div class="oer-info-app">

    <p class="info">Autor:<p>
    <p class="description"><%= @app.author %></p>

    <% @kinds.each do |cat| %>
      <% if @app.categories.any? {|c| c.kind == cat.kind } %>
        <p class="info"><%= cat.kind %>:</p>
        <p class="description"><%= (@app.categories.select { |a| a.kind == cat.kind }.collect &:name).first %></p>
      <% end %>
    <% end %>

    <p class="info">Objetivo:</p>
    <p class="description"><%= @app.objective %></p>

    <p class="info">Sinopse:</p>
    <p class="description"><%= @app.synopsis %></p>
  </div>

  <div class="oer-buttons">
    <button class="button-default" data-toggle="modal-app" data-modal-title="<%= @app.name %>" data-modal-subtitle="<%= @app.author %>" data-modal-url="<%= @app.url %>">Abrir este Recurso</button>
    <% unless @favorite || !@user %>
      <%= form_tag user_favorites_path(@user.id), method: "post" do %>
        <%= hidden_field_tag :app_id , @app.id %>
        <%= content_tag :button, :type => :submit, class: "button-primary" do %>
          Adicionar a Favoritos
        <% end %>
      <% end %>
    <% end %>
    <%= form_tag app_checkout_path(@app), method: "post" do %>
      <%= content_tag :button, :type => :submit, :class => "button-primary", :'data-target' => "#modal-add-oer-step-1", :'data-toggle' => "modal", class: "button-success"  do %>
        Adicionar a Disciplina
      <% end %>
    <% end %>
    <% if @favorite %>
      <%= link_to "Remover dos Favoritos", user_favorite_path(current_user, @favorite), :method => "delete", :class => "icon-favorite-delete-lightblue_16_18-before", :title => "Remover dos Favoritos" %>
    <% end %>
  </div>

  <div class="oer-meta-data">
    <div class="meta-data-column-1">
      <p><span>Publicador:</span> <%= @app.publishers %></p>
      <p><span>Detentor dos Direitos:</span> <%= @app.copyright %></p>
      <p><span>Submetido por:</span> <%= @app.submitters %></p>
      <p><span>Classificação:</span> <%= @app.classification %></p>
    </div>

    <div class="meta-data-column-2">
      <p><span>Língua:</span> <%= @app.language %></p>
      <p><span>País de Origem:</span> <%= @app.country %></p>
      <p><span>Classificação:</span> <%= @app.publishers %></p>
      <p><span>Origem:</span> <%= @app.url %></p>
    </div>
  </div>

  <div class="oer-images">

    <% @app.screen_shots.each do |ss| %>
      <%= image_tag ss.screen.url(:original) %>
    <% end %>

  </div>
</div>

<ol class="statuses oer-comments">
  <%= render partial: 'specialized_comment', collection: @app.comments.specialized %>

  <% if current_user %>
    <!-- Botões de comentários -->
    <li>
      <hr class="list-separator">
      <div class="status status-buttons reply-buttons">
        <ul class="status-text">
          <li>
            <button class="button-primary button-big reply-status button-comment icon-comment-white_blue_32_34-before">Comentar sobre este aplicativo</button>
          </li>
          <% if @user.specialist? %>
            <li>
              <button class="button-primary button-big reply-status button-review icon-specialist-white_blue_32_34-before">Escrever uma resenha</button>
            </li>
          <% end %>
        </ul>
        <%= render "create_response", klass: "flap-to-comment", model_object: [@app, @app.comments.build], comment_type: "common" %>
        <% if @user.specialist? %>
          <%= render "create_response", klass: "flap-to-review", model_object: [@app, @app.comments.build], comment_type: "specialized" %>
        <% end %>
      </div>
    </li>
  <% end %>

  <!-- Comentários comuns -->
  <div id="comments" >
    <%= render partial: 'common_comment', collection: @comments %>
  </div>
</ol>

<% unless @comments.last_page? %>
  <div id="pagination-wrapper">
    <hr class="list-separator">
    <div id="paginator" class="pagination">
      <%= link_to_next_page(@comments, "Mostrar mais...", remote: true,
                            class: "button-default icon-arrow-down-pagination-gray_16_18-before") %>
    </div>
  </div>
<% end %>
