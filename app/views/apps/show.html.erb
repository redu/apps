
<%= form_tag app_checkout_path(@app, previous_step: 0), method: :post, remote: true do %>
  <%= content_tag :button, type: :submit, class: "button-primary button-success" do %>
    Adicionar a Disciplina
  <% end %>
<% end %>

<%= render_navigation :renderer => :breadcrumbs, :join_with => " &gt; " %>
<p id="notice"><%= notice %></p>
<%= image_tag @app.thumbnail.url(:thumb) %><h1> <%= @app.name %> </h1>
<% if @user %>
  <%= link_to "1", rate_app_path(@app, rating: 1), method: "post" %>
  <%= link_to "2", rate_app_path(@app, rating: 2), method: "post" %>
  <%= link_to "3", rate_app_path(@app, rating: 3), method: "post" %>
  <%= link_to "4", rate_app_path(@app, rating: 4), method: "post" %>
  <%= link_to "5", rate_app_path(@app, rating: 5), method: "post" %>
  <%= @app.reputation_for(:rating) %>/5
  <br />
  <% if @evaluated %>
    Você deu <%= @user_rating %> a este aplicativo
  <% else %>
    Classifique este recurso
  <% end %>
<% else %>
  <%# TODO exibir rating do app sem opção de o usuário dar rate %>
<% end %>
<ul>
  <% @app.attributes.except("id", "thumbnail_file_name", "thumbnail_content_type",
      "thumbnail_file_size", "thumbnail_updated_at", "created_at", "name",
      "updated_at").each do |att|
        %>
    <% unless att.first == 'views' %>
      <li><%= t(att.first) %>: <%= att.second %></li>
    <% end %>
  <% end %>
  <li><%= t 'views', count: @app.views %></li>
  <li><%= t 'review', count: @app.comments.specialized.count %></li>
  <li>
    <%= t 'comment',
          count: (@app.comments.common.count + @app.comments.answer.count) %>
  </li>
</ul>
<% @app.screen_shots.each do |ss| %>
  <%= image_tag ss.screen.url(:original) %>
<% end %>

<h2>Resenhas</h2>
<% @app.comments.specialized.each do |comment| %>
  <p>
    <%= image_tag comment.author.thumbnail.url(:medium) %>
    <%= "#{comment.author.first_name} #{comment.author.last_name}" %> (especialista)
    escreveu uma resenha sobre este aplicativo:<br /><%= l comment.created_at %>
  </p>
  <p>
    <%= comment.body %>
    <%= link_to 'Apagar Comentário', [comment.app, comment],
               :confirm => 'Tem certeza?',
               :method => :delete %>
  </p>
<% end %>

<h2>Escrever uma resenha</h2>
<%= form_for([@app, @app.comments.build]) do |f| %>
  <div class="field">
    <%= f.label :autor %> (login do usuário)<br />
    <%= f.text_field :author %>
  </div>
  <div class="field">
    <%= f.label :corpo %><br />
    <%= f.text_area :body %>
  </div>
    <%= f.hidden_field :type, :value => 'specialized' %>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>

<h2>Comentários</h2>
<% @app.comments.common.each do |comment| %>
  <p>
    <%= image_tag comment.author.thumbnail.url(:medium) %>
    <%= "#{comment.author.first_name} #{comment.author.last_name}" %>
    comentou sobre este aplicativo:
    <br /><%= l comment.created_at %>
  </p>
  <p>
    <%= comment.body %>
    <%= link_to 'Apagar Comentário', [comment.app, comment],
               :confirm => 'Tem certeza?',
               :method => :delete %>
  </p>
  <% comment.answers.each do |answer| %>
    <p>
      <%= image_tag answer.author.thumbnail.url(:medium) %>
      <b><%= "#{answer.author.first_name} #{answer.author.last_name}" %></b>
      respondeu:<br /><%= l answer.created_at %>
    </p>
    <%= answer.body %>
    <%= link_to 'Apagar Resposta', [comment.app, comment, answer],
               :confirm => 'Tem certeza?',
               :method => :delete %>
  <% end %>

  <h2>Responder</h2>
  <%= form_for([@app, comment, @app.comments.build]) do |f| %>
    <div class="field">
      <%= f.label :autor %> (login do usuário)<br />
      <%= f.text_field :author %>
    </div>
    <div class="field">
      <%= f.label :corpo %><br />
      <%= f.text_area :body %>
    </div>
      <%= f.hidden_field :type, :value => 'answer' %>
    <div class="actions">
      <%= f.submit %>
    </div>
  <% end %>
<% end %>

<h2>Comentar sobre este aplicativo</h2>
<%= form_for([@app, @app.comments.build]) do |f| %>
  <div class="field">
    <%= f.label :autor %> (login do usuário)<br />
    <%= f.text_field :author %>
  </div>
  <div class="field">
    <%= f.label :corpo %><br />
    <%= f.text_area :body %>
  </div>
    <%= f.hidden_field :type, :value => 'common' %>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>

<%= link_to 'Back', apps_path %>
<%= link_to 'Preview', preview_app_path(@app) %>
<%= form_tag user_favorites_path(@user.id), :method => "post" do %>
   <%= hidden_field_tag :app_id , @app.id %>
   <%= submit_tag("Adcionar a Favoritos") %>
<%= link_to 'Adicionar Aplicativo a uma aula', app_checkout_path(@app) %>
<% end %>
<%= render_navigation :renderer => :breadcrumbs, :join_with => " &gt; " %>
