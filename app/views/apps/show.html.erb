
<div class="oer-main">

  <h2> <%= @app.name %> </h2>

  <div class="oer-data">
    <p id="notice"><%# notice %></p>
    <%= image_tag @app.thumbnail.url(:large) %>
    <% if @user %>

      <ul class="oer-stars">
        <% 5.times do |n| %>
          <li><%= link_to "#{n+1}", rate_app_path(@app, rating: n+1), method: "post", class: "icon-star-full-gray_16_18 show text-replacement" %></li>
        <% end %>
      </ul>

      <h6><%= @app.reputation_for(:rating) %><span>/5</span></h6>
      <ul class="data-app">
        <li class="app-rating">
          <% if @evaluated %>
            Você deu <%= @user_rating %> a este aplicativo
          <% else %>
            Classifique este recurso
          <% end %>
        </li>
    <% else %>
      <%# TODO exibir rating do app sem opção de o usuário dar rate %>
    <% end %>
      <li class="icon-star-empty-gray_16_18-before">xxx classificações.</li>
      <li class="icon-favorite-gray_16_18-before">xxx favoritos.</li>
      <li class="icon-seen-gray_16_18-before"><%= t 'views', count: @app.views %></li>
      <li class="icon-specialist-gray_16_18-before"><%= t 'review', count: @app.comments.specialized.count %></li>
      <li class="icon-comment-gray_16_18-before">
        <%= t 'comment', 
              count: (@app.comments.common.count + @app.comments.answer.count) %>
      </li>
    </ul>

    <div class="oer-cc">
      <span class="cc-by-88_31 text-replacement" rel="popover" data-original-title="Licença por Atribuição (by)" data-content="Esta licença permite que outros distribuam, remixem, adaptem ou criem obras derivadas, mesmo que para uso com fins comerciais, contanto que seja dado crédito pela criação original. Esta é a licença menos restritiva de todas as oferecidas, em termos de quais usos outras pessoas podem fazer de sua obra." data-placement="bottom">Licença por Atribuição (by)</span>
    </div>
  </div>


  <div class="oer-info-app">

    <p class="info">Autor:<p>
    <p class="description"><%= @app.author %></p>

    <% @kinds.each do |cat| %>
      <% if @app.categories.any? {|c| c.kind == cat.kind } %>
        <p class="info"><%= cat.kind %>:</p> 
        <p class="description"><%= (@app.categories.select { |a| a.kind == cat.kind }.collect &:name).first %></p>
      <% end %>
    <% end %>

    <p class="info">Objetivo:</p>
    <p class="description"><%= @app.objective %></p>

    <p class="info">Sinopse:</p>
    <p class="description"><%= @app.synopsis %></p>
  </div>

  <div class="oer-buttons">
    <%= form_tag preview_app_path(@app), method: "get" do %>
      <%= content_tag :button, :type => :submit, :class => "button-default" do %>
        Abrir este Recurso
      <% end %>
    <% end %>
    <%= form_tag user_favorites_path(@user.id), method: "post" do %>
      <%= hidden_field_tag :app_id , @app.id %>
      <%= content_tag :button, :type => :submit, class: "button-primary" do %>
        Adicionar a Favoritos
      <% end %>
    <% end %>
    <%= form_tag app_checkout_path(@app), method: "post" do %>
      <%= content_tag :button, :type => :submit, :class => "button-primary", :'data-target' => "#modal-add-oer-step-1", :'data-toggle' => "modal", class: "button-success"  do %>
        Adicionar a Disciplina
      <% end %>
    <% end %>
  </div>

  <div class="oer-meta-data">
    <div class="meta-data-column-1">
      <p><span>Publicador:</span> <%= @app.publishers %></p>
      <p><span>Detentor dos Direitos:</span> <%= @app.copyright %></p>
      <p><span>Submetido por:</span> <%= @app.submitters %></p>
      <p><span>Classificação:</span> <%= @app.classification %></p>
    </div>

    <div class="meta-data-column-2">
      <p><span>Língua:</span> <%= @app.language %></p>
      <p><span>País de Origem:</span> <%= @app.country %></p>
      <p><span>Classificação:</span> <%= @app.publishers %></p>
      <p><span>Origem:</span> <%= @app.url %></p>
    </div>
  </div>

  <div class="oer-images">

    <% @app.screen_shots.each do |ss| %>
      <%= image_tag ss.screen.url(:original) %>
    <% end %>

  </div>
</div>

<div class="statuses oer-comments">
  <ol>
    <li class="status">
      <div class="status-wrapper">
        <div class="status-text">

          <% @app.comments.specialized.each do |comment| %>
            <span class="specialist-icon icon-specialist-gray_32_34-before text-replacement">Especialista</span>
            <%= image_tag comment.author.thumbnail.url(:medium), :class => "icon-link" %>
            <a href="#" class="link-name"><%= "#{comment.author.first_name} #{comment.author.last_name}" %></a> (especialista)
            escreveu uma resenha sobre este aplicativo:
            <%= link_to 'Apagar Comentário', [comment.app, comment],
                       :confirm => 'Tem certeza?',
                       :method => :delete,
                       :class => "close icon-close-gray_16_18 replacement" %>
            <span class="date"><%= l comment.created_at %></span>
        </div>
        <div class="status-container specialist">
          <div class="status-content">
            <div class="post-text">
              <p class="input-user">
                <%= comment.body %>
              </p>
            </div>
            <hr class="link-separator">
          </div>
        </div>
          <% end %>

      </div>
    </li>

    <hr class="list-separator">

    <div class="status status-buttons">
      <div>
        <ul class="status-text button-comment">
          <li><a class="reply-status button-big button-primary icon-specialist-gray_32_34-before">Comentar sobre este aplicativo</a></li>
        </ul>
        <div class="create-response">
          <form accept-charset="UTF-8" data-remote="true" method="post">
            <fieldset>
            <textarea id="status_text" cols="40" rows="6" style="height: 136px; overflow: hidden; word-wrap: break-word; resize: horizontal; "></textarea>
              <div class="status-buttons">
                <a class="cancel button-default" rel="nofollow" href="/pessoas/thaisbione/home">Cancelar</a>
                <button id="status_submit" class="button-primary" type="submit" name="commit">Enviar</button>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
      <div>
        <ul class="status-text button-review">
          <li><a class="reply-status button-big button-primary icon-specialist-gray_32_34-before">Escrever uma resenha</a></li>
        </ul>
        <div class="create-response">

          <%= form_for([@app, @app.comments.build]) do |f| %>
            <fieldset>
              <%= f.text_area :body, :id => "status_text", :cols => "40", :rows => "6", :style => "height: 136px; overflow: hidden; word-wrap: break-word; resize: horizontal; " %>
              <%= f.hidden_field :type, :value => 'specialized' %>
              <div class="status-buttons">
                <a class="cancel button-default" rel="nofollow" href="/pessoas/thaisbione/home">Cancelar</a>
                <!-- <button id="status_submit" class="button-primary" type="submit" name="commit">Enviar</button> -->
                <%= content_tag :button, :type => :submit, :class => "button-primary", :id => "status_submit", :name => "commit"  do %>
                  Enviar
                <% end %>
              </div>
            </fieldset>
          <% end %>

          <form accept-charset="UTF-8" data-remote="true" method="post">
          </form>
        </div>
      </div>
    </div>

  </ol>
</div>

    <%= form_for([@app, @app.comments.build]) do |f| %>
      <div class="field">
        <%= f.label :autor %> (login do usuário)<br />
        <%= f.text_field :author %>
      </div>
      <div class="field">
        <%= f.label :corpo %><br />
        <%= f.text_area :body %>
      </div>
        <%= f.hidden_field :type, :value => 'specialized' %>
      <div class="actions">
        <%= f.submit %>
      </div>
    <% end %>

    <% @app.comments.common.each do |comment| %>
      <p>
        <%= image_tag comment.author.thumbnail.url(:medium) %>
        <%= "#{comment.author.first_name} #{comment.author.last_name}" %>
        comentou sobre este aplicativo:
        <br /><%= l comment.created_at %>
      </p>
      <p>
        <%= comment.body %>
        <%= link_to 'Apagar Comentário', [comment.app, comment],
                   :confirm => 'Tem certeza?',
                   :method => :delete %>
      </p>
      <% comment.answers.each do |answer| %>
        <p>
          <%= image_tag answer.author.thumbnail.url(:medium) %>
          <b><%= "#{answer.author.first_name} #{answer.author.last_name}" %></b>
          respondeu:<br /><%= l answer.created_at %>
        </p>
        <%= answer.body %>
        <%= link_to 'Apagar Resposta', [comment.app, comment, answer],
                   :confirm => 'Tem certeza?',
                   :method => :delete %>
      <% end %>

      <h2>Responder</h2>
      <%= form_for([@app, comment, @app.comments.build]) do |f| %>
        <div class="field">
          <%= f.label :autor %> (login do usuário)<br />
          <%= f.text_field :author %>
        </div>
        <div class="field">
          <%= f.label :corpo %><br />
          <%= f.text_area :body %>
        </div>
          <%= f.hidden_field :type, :value => 'answer' %>
        <div class="actions">
          <%= f.submit %>
        </div>
      <% end %>
    <% end %>

    <h2>Comentar sobre este aplicativo</h2>
    <%= form_for([@app, @app.comments.build]) do |f| %>
      <div class="field">
        <%= f.label :autor %> (login do usuário)<br />
        <%= f.text_field :author %>
      </div>
      <div class="field">
        <%= f.label :corpo %><br />
        <%= f.text_area :body %>
      </div>
        <%= f.hidden_field :type, :value => 'common' %>
      <div class="actions">
        <%= f.submit %>
      </div>
    <% end %>


<script type="text/javascript">

  $(".oer-stars li").hover(function() {
    var star = $(this).attr('id');
    for (i = 1; i <= star; i++) {
      $(".oer-stars li#" + i + " span").removeClass("icon-star-full-lightgray_16_18").addClass("icon-star-full-lightblue_16_18");
    }
  }, function() {
    var star = $(this).attr('id');
    for (i = 1; i <= star; i++) {
      $(".oer-stars li#" + i + " span").removeClass("icon-star-full-lightblue_16_18");

      if (!$(".oer-stars li#" + i + " span").hasClass("icon-star-full-gray_16_18")) {
        $(".oer-stars li#" + i + " span").addClass("icon-star-full-lightgray_16_18");
      }
    }
  });

</script>
